{% extends "baseNavbar.html" %}
{% block content %}

<div class="container">
  <div class="py-5 text-center">
  </div>
  <form class="needs-validation" novalidate>
  <div class="row">
    <div class="col-md-4 order-md-2 mb-4">
      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted">Items do Orçamento</span>
        <span class="badge badge-secondary badge-pill"></span>
      </h4>
      <ul class="list-group mb-3">
        <div class="produto">
        
      </div>
    </form>  
        <li class="list-group-item d-flex justify-content-between">
          <span>Total (R$)</span>
          <strong id="total">$0</strong>
        </li>
      </ul>

      <form class="card p-2">
        <div class="input-group">
            <div class="input-group-append">
            <button type="button" class="btn btn-secondary" id="gerar">Gerar Orçamento</button>
          </div>
        </div>
      </form>
    </div>
    <div class="col-md-8 order-md-1">
      <h4 class="mb-3">Produtos</h4>
      <form class="needs-validation" novalidate id="formprod">
          <div class="form-row align-items-center">
              <div class="col-auto my-1">
                <label class="mr-sm-2 sr-only" for="inlineFormCustomSelect">Preferência</label>
                <select class="custom-select mr-sm-2" id="inlineFormCustomSelect"name="prod">
                  <option selected>Escolher...</option>
                  {% for Produto in produtos %}
                  <option>{{ Produto.nome }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-auto my-1">
                <div class="custom-control custom-checkbox mr-sm-2">
                  <button class="btn btn-primary" type="button"  id="addInput">Adicionar</button>
                  
                </div>
              </div>
            </div>
            <div class="ccol-auto mb-1">
              <label for="primeiroNome">CPF</label>
              <input type="text" class="form-control" id="CPF" name="cpf_cliente"placeholder="Digite o CPF do Cliente" value="" required>
            </div>
      </form>
    </div>
  </div>

</div>
<script>
			$(function () {
			    var scntDiv = $('.produto');
          $(document).on('click', '#addInput', function () {
            $.ajax({
            url: '/adicionar/produto/',
            data: $('#formprod').serialize(),
            type: 'POST',
            success: function(response) {
              $('<li class="list-group-item d-flex justify-content-between lh-condensed">'+
          '<div id="preco">'+
            '<h6 class="my-0">'+response.nome+'</h6>'+
            '<small class="text-muted" name="nome_Produto">'+response.nome+'</small>'+
          '</div>'+
          '<span class="text">'+response.preco+'</span>'+
        '<a class="btn btn-danger" href="javascript:void(0)" id="remInput">'+
							'<span class="glyphicon glyphicon-minus" aria-hidden="true"></span> '+
							'Remover produto'+
                '</a>'+'</li>').appendTo(scntDiv);
             
              var itens = document.querySelectorAll(".text");
              var total = 0;
              console.log(itens);
              itens.forEach.call(itens, function(item) {
                console.log(item);
                total += parseInt(Number(item));

              });

              $('#total').text(total);
                          
                            
                          },
            error: function(error) {
                console.log(error);
            }
          });
                
			        return false;
			    });
			    $(document).on('click', '#remInput', function () {
		            $(this).parents('li').remove();
			        return false;
			    });
          $(document).on('click', '#gerar', function () {
            var scntDiv = $('.produto');
            $.ajax({
            url: '/orcamento/cadastrar/',
            data: $('.needs-validation').serialize(),
            type: 'POST',
            success: function(response) {
              console.log(response);
            },
            error: function(error) {
                console.log(error);
            }
          });
                
			        return false;
			    });
			    });
      $("#formprod").blur(function(){
            //declaro uma var para somar o total
            var total = 0;
            //faço um foreach percorrendo todos os inputs com a class soma e faço a soma na var criada acima
            $(".soma").each(function(){
                total = total + Number($(this).val());  
            });
            //mostro o total no input Sub Total
            $("#total").val(total);
        });
      
			</script>
{% endblock %}